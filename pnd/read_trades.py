import ast
import pathlib

import pandas as pd
import utils

pair = 'MDABTC'
start_date = None   # The start filtering date (format: 'YYYY-MM-DD HH:MM:SS')
end_date = None     # The end filtering date (format: 'YYYY-MM-DD HH:MM:SS')

if __name__ == '__main__':
    pd.set_option('display.max_rows', None)
    pd.set_option('display.max_columns', None)
    pd.set_option('display.width', None)

    data = []
    with open(f'data/trades/{pair}.csv', 'r') as f:
        for line in f:
            data.append(ast.literal_eval(line.strip()))
    df = pd.DataFrame(data)
    df.columns = utils.BINANCE_TRADES_COLS
    df = df.drop(columns=['Ignore'])
    df['Event time'] = pd.to_datetime(df['Event time'] * 1000000)
    df['Trade time'] = pd.to_datetime(df['Trade time'] * 1000000)

    # Filter dates
    if start_date and end_date:
        df = df.loc[(df['Trade time'] >= start_date) & (df['Trade time'] <= end_date)]

    # Save a nicely printed version of the DataFrame
    pathlib.Path('data/printed').mkdir(parents=True, exist_ok=True)
    with open(f'data/printed/{pair}.txt', 'w') as f:
        f.write(str(df))
